# GitXab.vim 仕様書

## 概要
GitXab.vimは、Vim/Neovim上でGitLabのWeb UIと同等の機能を提供するプラグインです。将来的にはGitHubにも対応予定です。

## 機能要件

### 1. プロジェクト管理
#### 1.1 プロジェクト一覧
- プロジェクトの一覧表示
- プロジェクトの検索機能
  - プロジェクト名による検索
  - 説明文による検索
  - タグによる検索

### 2. Issue管理
#### 2.1 Issue一覧
- プロジェクトごとのissue一覧表示
- issue検索機能
  - タイトルによる検索
  - 説明文による検索
  - ステータスによるフィルタリング
  - アサイン者によるフィルタリング
  - ラベルによるフィルタリング

#### 2.2 Issue詳細
- issue内容の表示
- コメントの表示
- 新規コメントの投稿
- コメントへの返信
- issueのステータス変更
- アサイン者の変更
- ラベルの編集

### 3. Merge Request管理
#### 3.1 MR一覧
- プロジェクトごとのMR一覧表示
- MR検索機能
  - タイトルによる検索
  - 説明文による検索
  - ステータスによるフィルタリング
  - レビュワーによるフィルタリング

#### 3.2 MR詳細
- MR内容の表示
- コメントの表示・投稿
- コメントへの返信
- MRのステータス変更
- レビュワーの変更

#### 3.3 差分表示
- ファイル単位の差分表示
- インライン差分コメント
- コメントへの返信
- 差分のナビゲーション

## 技術要件

### 1. 技術スタック
#### フロントエンド (Denops/TypeScript)
- denops.vim 5.x以降
- Neovim 0.7以降
- Deno 1.x以降
- TypeScript 5.x以降
- Denops標準API（バッファ管理、コマンド登録、UI操作）

#### バックエンド (Deno/TypeScript ライブラリ)
- Deno 1.x以降
- TypeScript 5.x以降
- GitLab API v4クライアントライブラリ
- 認証管理ライブラリ
- キャッシュシステム（ETagベース）

#### CLI
- バックエンドライブラリ（`deno-backend/mod.ts`）を直接インポート
- CLI は JSON を stdout に出力する設計とし、自動化やデバッグ、CI レシピから直接利用可能
- Denopsプラグインと同じライブラリを共有することでコードの重複を排除

### 2. アーキテクチャ
#### Denopsプラグイン層（`denops/gitxab/main.ts`）
- TypeScriptベースのプラグインコア
- Denops APIを利用したバッファ管理
- コマンド登録とディスパッチャー
- UI/UXコンポーネント
- バックエンドライブラリとの直接統合

#### バックエンドライブラリ層（`deno-backend/mod.ts`）
- GitLab REST APIクライアント
- 認証管理（環境変数、設定ファイル、将来的にOSキーリング）
- ETagベースキャッシュマネージャー
- エラーハンドリングとレスポンスパース
- 型定義のエクスポート

#### プロセス通信
- denops.vimがNeovimとDenoプロセス間の通信を自動管理（msgpack-rpc）
- ユーザーは通信を意識する必要がない
- denops起動時に自動的にDenoプロセスが起動

### 3. パフォーマンス要件
- コマンド実行から表示までの最大レイテンシ: 500ms
- メモリ使用量の上限: 512MB
- キャッシュの有効期限設定
- バッファリングとページネーション

### 4. セキュリティ
- 認証情報の安全な保存
- SSL/TLS通信
- レート制限への対応
- エラーメッセージのサニタイズ

### 5. 拡張性
- プラグインシステム
- GitHubプロバイダーの追加サポート
- カスタムUIテーマ
- ユーザー定義コマンド

## 制約条件
1. Neovim 0.7以降のみをサポート（denops互換）
2. denops.vim 5.x以降が必要
3. Deno 1.x以降が必要
4. SSL/TLS通信のサポート
5. UTF-8エンコーディングのサポート
6. 最低2GB以上のRAM
7. GitLab API v4との互換性
8. プロキシ環境での動作サポート

## 実装フェーズ
### フェーズ1: 基本機能
1. プロジェクト一覧表示・検索
2. Issue一覧表示・検索
3. Issue詳細表示・コメント

### フェーズ2: MR管理
1. MR一覧表示・検索
2. MR詳細表示・コメント
3. 差分表示

### フェーズ3: 拡張機能
1. インライン差分コメント
2. 高度な検索機能
3. GitHub API対応

## テスト要件
1. ユニットテスト
   - API通信のモック
   - コマンド実行のテスト
   - UI操作のテスト

2. 統合テスト
   - 実際のGitLab APIとの連携テスト
   - エラーケースの検証

3. E2Eテスト
   - 実際のワークフローのテスト
   - パフォーマンステスト

## 成功基準
1. GitLabのWeb UIで実行可能な主要な操作が全てVim上で実行可能
2. コマンド実行からレスポンス表示までの遅延が500ms以内
3. エラー発生時の適切なフィードバック提供
4. 95%以上のテストカバレッジ
5. ドキュメントの完備
   - インストール手順
   - 設定ガイド
   - コマンドリファレンス
   - トラブルシューティングガイド

## 変更履歴
- 2025-11-03: 初版作成
- 2025-11-09: アーキテクチャをdenopsベースに変更。バックエンドをサーバーからライブラリ化